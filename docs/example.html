<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SowString Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
</head>
<body>

<header>
    <div>
        <h1>Sow String Example</h1>
        <p>Let's play with Sow String Library!</p>
    </div>
    <div class="float">
        <a href="https://ezaca.github.com/sowstring/docs/index.html">Documentation</a>
        <a href="https://ezaca.github.com/sowstring/dist/sowstring.min.js" download>Download</a>
        <a href="https://github.com/ezaca/sowstring">GitHub</a>
        <a href="https://github.com/ezaca/sowstring/blob/master/LICENSE">License</a>
    </div>
</header>
<main class>
    <div>
        <h2>Input</h2>
        <p>Type the string here and let the rest with us:</p>
        <textarea id="in1" oninput="doTheMagic()">Loading content with Javascript...</textarea>
        <div><label><input type="checkbox" id="in_heading" onclick="doTheMagic()"> Use heading items?</label></div>
        <div><label><input type="checkbox" id="in_empty" onclick="doTheMagic()"> Include empty lines?</label></div>
        <div><label><input type="checkbox" id="in_filter" onclick="doTheMagic()"> Filter should ignore <code>//</code> and <code>#</code> lines?</label></div>
        <div><label><input type="checkbox" id="in_intercept" onclick="doTheMagic()"> Intercept lines to recognize commands :child, :parent and :sibling</label></div>
    </div>
    <div>
        <h2>Output</h2>
        <p>When we apply <code class="pretty">SowString</code> we get the following (object as JSON):</p>
        <pre id="out1"></pre>
    </div>
    <div>
        <p>If we revert with <code class="pretty">UnsowString</code>, the "each" callback can format it as:</p>
        <pre id="out2"></pre>
    </div>
</main>

<footer>&copy; 2017 Eliakim Zacarias. The MIT License.</footer>

<script type="text/javascript" src="../dist/sowstring.min.js"></script>
<script type="text/javascript">

var in1 = document.getElementById('in1')
var in_heading = document.getElementById('in_heading')
var in_empty = document.getElementById('in_empty')
var in_filter = document.getElementById('in_filter')
var in_intercept = document.getElementById('in_intercept')
var out1 = document.getElementById('out1')
var out2 = document.getElementById('out2')

in1.value =
`Parent Node 1
    Child Node 1
        Grandson Node 1
    Child Node 2
    # Child Node 3 (filter will ignore)
    Child Node 4
Parent Node 2
// Parent Node 3 (filter will ignore)
This line will be child if intercepted :child
    Normal child of previous item
This will be child with previous if intercepted is active :auto
`

function doTheMagic(){
    // Sow the string to crop the tree
    try{
        var options = {}
        options.useHeading = in_heading.checked
        options.emptyLines = in_empty.checked
        if (in_filter.checked)
            options.filter = function(ln, indent){
                if(ln.match(/^(\/\/|#)/))
                    return false
                return true
            }
        if (in_intercept.checked)
            options.intercept = function(ln, indent, lineIndex, lines){
                if (ln.match(/:child/i))
                    return this.child
                if (ln.match(/:parent/i))
                    return this.parent
                if (ln.match(/:sibling/i))
                    return this.sibling
                if (ln.match(/:auto/i))
                    return 'auto'
            }
        var tree = SowString(in1.value, options)
    }catch(e){
        out1.innerText = e
        out2.innerText = e.stack
        return
    }

    // Get tree as JSON
    out1.innerText = JSON.stringify(tree, null, 4)

    // Revert the tree to string
    // out2.innerHTML = UnsowString(tree);

    // Harvest data from tree
    out2.innerHTML = UnsowString(tree, {
        each: function(node, item){
            var indent
            var text
            var level
            var replacements = {'<':'lt','>':'gt','&':'amp','"':'quot'}
            if (item===undefined)
            {
                if (! node.heading)
                    return
                indent = '<span style="color:#ccc">'+String('·').repeat(node.parent.indent)+'</span>'
                text = String(node.heading).replace(/[<>&"]/g, (match)=>{return '&'+replacements[match]+';'})
                level = ' <span style="color:#888;font-size:0.7em">[Heading Level='+node.parent.level+']</span>'
                return indent+text+level
            }
            indent = '<span style="color:#ccc">'+String('·').repeat(node.indent)+'</span>'
            text = String(item).replace(/[<>&"]/g, (match)=>{return '&'+replacements[match]+';'})
            level = ' <span style="color:#888;font-size:0.7em">[Level='+node.level+']</span>'
            return indent+text+level
        }
    })
}

doTheMagic()
</script>
</body>
</html>